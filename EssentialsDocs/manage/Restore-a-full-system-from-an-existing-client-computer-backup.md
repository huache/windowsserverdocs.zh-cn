---
title: 从现有客户端计算机备份还原完整系统
description: 描述如何使用 Windows Server Essentials
ms.date: 10/03/2016
ms.topic: article
ms.assetid: 47e498a6-1b71-47de-88f6-8c13c221d108
author: nnamuhcs
ms.author: geschuma
manager: mtillman
ms.openlocfilehash: 6b93e0e31c592a11d44aca74029012a1b6229227
ms.sourcegitcommit: db2d46842c68813d043738d6523f13d8454fc972
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/10/2020
ms.locfileid: "89622980"
---
# <a name="restore-a-full-system-from-an-existing-client-computer-backup"></a>从现有客户端计算机备份还原完整系统

>适用于： Windows Server 2016 Essentials、Windows Server 2012 R2 Essentials、Windows Server 2012 Essentials

 尽管硬件和操作系统故障很少见，但仍然可能发生。 出现故障的风扇可能导致计算机主板过热并使其无法工作。 操作系统可能损坏并无法启动。 火和水可能导致硬件永久损坏。 硬盘可能出现故障，或者你可能决定换一个容量更大的硬盘。

 本文档提供有关以下主题的信息：

-   [什么是计算机完整系统还原？](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_WhatIs)

-   [系统还原环境是如何工作的？](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_HowDoes)

-   [创建可启动的 U 盘以还原客户端计算机](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_CreateBootable)

-   [使用完整系统还原向导](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_Using)

-   [在哪里可以找到适用于我的硬件的驱动程序？](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_FindDrivers)

##  <a name="what-is-computer-full-system-restore"></a><a name="BKMK_WhatIs"></a> 什么是计算机完整系统还原？
 如果你更换硬盘或计算机由于故障而无法使用或启动，则可以从先前的计算机备份还原系统。 完整系统还原会将系统还原为备份时的状态。

> [!IMPORTANT]
>  不能在与被替换的计算机硬件不类似的计算机硬件（例如系统板）上执行完整系统还原。 已安装的操作系统基本上取决于计算机的基本硬件。 但是，你可以在容量等于或大于被替换硬盘的硬盘上执行完整系统还原。

 执行完整系统还原时，你可以选择特定的计算机备份来还原系统，以及用户所熟悉的在故障、灾难或失窃发生之前使用的所有应用程序、配置和设置。 你还可以选择想要还原的卷。

 规划或准备将完整系统还原到网络计算机时，请考虑以下内容：

### <a name="windows-preinstallation-environment"></a>Windows 预安装环境
 Windows 预安装环境 (Windows PE) 是旨在为 Windows 安装准备计算机的最小操作系统。 对于运行 Windows Server Essentials 的服务器，当你在要还原的计算机上插入还原介质时，会自动安装 Windows PE。 对于运行 Windows Server Essentials 的服务器，当你通过客户端还原服务或 u 盘启动计算机时，将自动安装 Windows PE。

 Windows PE 不支持无线连接。 因此，要还原的计算机必须物理连接到小型企业网络。

### <a name="bitlocker"></a>BitLocker
 BitLocker 驱动器加密 (BitLocker) 是在某些版本的 Windows Vista、Windows 7 和 Windows 8 中提供的一项数据保护功能。 BitLocker 可保护丢失或被盗的计算机中的数据免遭偷窃或泄漏，并提供在计算机淘汰时更安全地删除数据的方法。

 **对于 Windows Server Essentials：** 如果需要还原的计算机是使用 BitLocker 加密的 (它是只是操作系统驱动器还是操作系统驱动器以及单个或多个固定驱动器) ，你仍可以使用服务器随附的 CD 中包含的完整系统还原介质，并使用完整系统还原向导从备份中重新安装硬盘驱动器映像（包括操作系统），并将数据还原到新的或已修复的计算机。

 **对于 Windows Server Essentials：** 如果你需要还原的计算机已使用 BitLocker 加密 (不管是只是操作系统驱动器还是操作系统驱动器以及单个或多个其他固定驱动器) ，你仍可以使用完整系统还原向导从备份中重新安装硬盘映像，包括操作系统，然后将数据还原到新的或已修复的计算机。

 当服务器备份驱动器、文件夹和文件时，会将未加密版本保存到服务器。 完整系统还原过程中，会将此未加密的版本复制到计算机中。

> [!NOTE]
>  成功执行完整系统还原后，你必须重新激活计算机上的 BitLocker。
>
>  有关如何在运行 Windows 8 的计算机上启用 BitLocker 的说明，请参阅 [bitlocker：如何启用 bitlocker](https://go.microsoft.com/fwlink/p/?LinkID=254918)。
>
>  有关如何在运行 Windows 7 的计算机上启用 BitLocker 的说明，请参阅 [BitLocker 驱动器加密适用于 windows 7 的循序渐进指南](https://go.microsoft.com/fwlink/p/?LinkId=140225)。

 有关 BitLocker 驱动器加密基础知识的详细信息，请参阅 [BitLocker 常见问题 (FAQ)](https://go.microsoft.com/fwlink/p/?LinkID=254917)。

### <a name="encrypting-file-system-encrypted-files"></a>使用加密文件系统加密的文件
 Windows 中的加密文件系统 (EFS) 功能能够为同一台计算机上多个用户之间的不同安全级别提供额外的基于用户的文件级别加密。 一定要注意，与使用 BitLocker 加密的硬盘不同，使用 EFS 加密的文件和文件夹在任何计算机备份中仍然是加密的。 EFS 在 Windows XP Home Edition、Windows Vista Starter、Windows Vista Home Basic、Windows Vista 家庭高级版、Windows 7 简易版、Windows 7 家庭普通版、Windows 7 家庭高级版或 Windows 8 中不可用。 它仅在 Windows 8 专业版中可用。

> [!WARNING]
>  与 BitLocker 不同，你只能从加密文件的操作系统中访问受 EFS 保护的文件。

### <a name="disk-partitions"></a>磁盘分区
 如果新计算机上的硬盘容量等于或大于原始计算机上的硬盘容量，则会自动对该硬盘重新进行格式化和分区。 有关详细信息，请参照以下图表：

|原始计算机|还原的计算机或新计算机|
|-----------------------|------------------------------|
|具有多个分区的单个磁盘|具有多个分区的单个磁盘，任何额外空间被分配给最后一个分区|
|具有单个分区的单个磁盘|具有单个分区的单个磁盘，所有可用空间都用于该分区|

> [!NOTE]
>  如果原始计算机与还原的计算机或新计算机的磁盘容量和分区布局不同，则必须使用磁盘管理在还原的计算机或新计算机上创建合适的分区。 你可以在完整系统还原向导中执行此操作。

### <a name="raid-and-dynamic-disks"></a>RAID 和动态磁盘
 不支持备份独立磁盘的冗余阵列 (RAID) 和动态磁盘。

##  <a name="how-does-the-system-restore-environment-work"></a><a name="BKMK_HowDoes"></a> 系统还原环境是如何工作的？
 随 Windows Server 2012 Essentials 一起提供的系统还原介质将 &reg; Windows 预安装环境计算机上 (WINDOWS PE) 安装。 Windows PE 会替换 MS-DOS 环境并包含 Windows 的核心程序文件。 在 Windows Server Essentials 中，有两种支持的系统还原方法：使用客户端还原服务，该服务使用网络并且不依赖于媒体，或使用 USB 闪存驱动器。

> [!NOTE]
>  Windows PE 不支持无线连接。 因此，要还原的计算机必须物理连接到小型企业网络。

 系统还原环境提供 32 位 (x86) 和 64 位 (x64) 的程序文件。 在插入系统还原介质之后，选择合适的文件版本。 32 位 (x86) 为默认版本，如果你在 30 秒内未进行选择，则会自动选择该版本。 如果服务器上存在完整系统还原程序文件的更新，则更新的文件会自动下载到计算机。

 安装预安装环境后，完整系统还原向导会启动。 该向导会帮助你从以前的备份还原计算机。 还可以使用系统还原环境将备份还原到具有相似硬件的新计算机。

 在大多数情况下，系统还原环境上包含的程序文件和驱动程序是重新启动新计算机或已还原计算机所需的所有内容。 系统还原环境可能不包括重新启动新计算机或已还原计算机时所需的所有存储和网络适配器驱动程序，具体取决于新计算机或已还原的计算机硬件。 完整系统还原向导使你有机会安装驱动程序（如果需要）。 有关查找硬件驱动程序的信息，请参阅[在哪里可以找到适用于我的硬件的驱动程序？](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_FindDrivers)。 有关如何使用系统还原介质的信息，请参阅[使用完整系统还原向导](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_Using)。

##  <a name="create-a-bootable-usb-flash-drive-to-restore-a-client-computer"></a><a name="BKMK_CreateBootable"></a> 创建可启动的 u 盘以还原客户端计算机
 如果需要从现有备份还原客户端计算机，但找不到 (在 Windows Server Essentials 中的服务器附带的还原 CD) 或者你不希望在 Windows Server Essentials) 中的服务器 (上设置客户端还原服务，则可以创建可启动的 u 盘。 然后可以使用 U 盘启动客户端计算机并还原系统。 使用的 U 盘必须至少有 1 GB 或更大的可用空间。

#### <a name="to-create-a-bootable-usb-flash-drive"></a>创建可启动的 U 盘

1.  打开 **“仪表板”**。

2.  单击 **“设备”** 选项卡。

3.  在 **“任务”** 窗格中，单击 **“自定义计算机备份和文件历史记录设置”**。

    > [!NOTE]
    >  在 Windows Server Essentials 中，单击 " **客户端计算机备份任务**"。

4.  单击 **“工具”** 选项卡，然后单击 **“计算机恢复”** 部分的 **“创建密钥”**。 创建计算机恢复密钥向导随即打开。

5.  将 1 GB 或更大的 U 盘插入服务器中，然后按照向导中的说明进行操作。

    > [!CAUTION]
    >  U 盘中的所有数据都将删除。

##  <a name="using-the-full-system-restore-wizard"></a><a name="BKMK_Using"></a> 使用完整系统还原向导
 使用还原介质、客户端还原服务或 U 盘成功启动计算机并确认所有硬件驱动程序已加载到已还原的或新的客户端计算机后，将显示“完整系统还原”向导。 借助此向导，你可以访问服务器、计算机备份和你要还原到计算机的源卷，也可以执行实际还原过程。

> [!NOTE]
>   Windows Server Essentials 不支持以下还原方案：
>
> - 将主启动记录 (MBR) 磁盘还原到统一可扩展固件接口 (基于 UEFI) 的计算机。
>   -   将 UEFI/GPT 备份还原到 BIOS 系统。
>
>   如果在以上任一方案中还原数据，则将无法启动系统。 此外，还可能无法使用大小大于 2 TB 的硬盘。

 **先决条件：**

-   在启动完整系统还原过程之前，请使用网络电缆（有线连接）将计算机连接到与服务器相同的网络。 确保你有权访问客户端计算机上的所有硬盘。

    > [!WARNING]
    >  不要尝试对使用无线方式连接到网络的计算机执行完整系统还原。

-   如果你知道计算机缺少关键的网络或存储设备驱动程序，则需要在开始完整系统还原过程前，找到这些驱动程序并将它们复制到闪存驱动器。 对于 Windows Server Essentials：如果使用 CD 上提供的完整系统还原介质，则在完整系统还原过程的启动部分，该 CD 必须保留在驱动器中。 因此，不应将缺少的驱动程序复制到 CD 或 DVD 上，除非你有第二个 CD/DVD 驱动器。 但可以将缺少的驱动程序复制到 U 盘。

     有关如何找到适用于你计算机的驱动程序的信息，请参阅[在哪里可以找到适用于我的硬件的驱动程序？](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_FindDrivers)

-   对于 Windows Server Essentials：如果你找不到 Windows Server Essentials 还原 CD，则可以创建可启动的 u 盘。 有关详细信息，请参阅[创建可启动 U 盘来还原客户端计算机](Restore-a-full-system-from-an-existing-client-computer-backup.md#BKMK_CreateBootable)。

#### <a name="to-use-the-full-system-restore-wizard"></a>使用完整系统还原向导

1. 执行下列操作之一：

   -   Windows Server Essentials：打开要还原的客户端计算机，插入还原介质，然后关闭计算机。

        再次打开该计算机，并在开机自检 (POST) 过程中，按相应的功能键（F 键）来访问启动设备菜单，然后选择 CD/DVD 驱动器。 Windows 启动管理器将启动。

   -   Windows Server Essentials：如果你使用的是客户端还原服务，请使用 " **从网络启动** " 选项重新启动计算机。 否则，请使用 USB 密钥启动计算机。

        再次打开计算机，在开机自检 (POST) 过程中，按相应的功能键（F 键）来访问启动设备菜单，然后选择“从网络启动”****（或者可以选择从 USB 密钥启动）。 Windows 启动管理器将启动。

   > [!NOTE]
   >  查看计算机制造商随付的文档，以确定用于访问启动设备菜单的功能键。

2. 计算机还原介质包含 32 位 (x86) 和 64 位 (x64) 启动选项。 在 Windows 启动管理器中，选择****“完整系统还原 (x86)”或****“完整系统还原 (x64)”。 如果计算机的硬件驱动程序是 32 位的，则选择 x86；如果是 64 位的，则选择 x64。 已加载 Windows 文件，“完整系统还原”向导将执行检查，以确保所有硬件驱动程序都可用。

3. 在****“完整系统还原向导”窗口中，选择首选语言，然后单击箭头。

4. 为此计算机选择适当的****“时间和货币格式”以及****“键盘或输入法”。 单击 **“继续”** 。

5. 如果缺少驱动程序，将显示消息 "还原过程无法验证驱动程序"。 单击****“关闭”，然后在“欢迎”对话框上单击****“加载驱动程序”。

   1.  在****“检测硬件”对话框中，单击****“安装驱动程序”。

   2.  插入包含硬件驱动程序的 U 盘，然后在****“安装驱动程序”对话框上单击****“扫描”。

   3.  在****“安装驱动程序”对话框上，当找到驱动程序时单击****“确定”。

   4.  在****“检测硬件”对话框上，单击****“继续”。

6. 如果在执行初始检查或安装所有关键驱动程序时已找到所有驱动程序，则在****“完整系统还原”窗口上单击****“继续”。

7. 在****“欢迎使用完整系统还原向导”页上，单击****“下一步”。

8. 此向导将搜索你的服务器。

   1.  如果向导找不到你的服务器，你可以选择再次搜索或输入服务器的 IP 地址。

   2.  如果检测到多个服务器，系统将要求你选择一个。

   3.  如果找到了服务器，将显示 "**登录到 <服务器名称 \> ** " 页。

9. 在 "**登录到 <服务器名称 \> ** " 页上，在 "**用户名**" 文本框中键入 *<用户名 \> * ，在 "**密码**" 文本框中键入管理员帐户密码，然后单击 "**下一步**"。

    > [!IMPORTANT]
    >  必须使用以英语创建的管理员帐户。 如果你没有此类帐户，那么你必须创建一个新的管理员帐户。 若要执行此操作，请先打开服务器仪表板上的“用户”**** 选项卡，接着将键盘语言格式设置为英语，然后运行“添加用户帐户”**** 任务以创建管理员帐户。 接下来，使用新的管理员帐户继续还原客户端计算机。

10. 在****“选择要还原的计算机”页上，选择要还原的计算机，然后单击****“下一步”。 你可以选择 " **<ComputerName \> ： (此计算机") ** 或者从 " **另一台计算机** " 下拉列表中选择网络上的其他计算机。

    > [!NOTE]
    >  如果此计算机对服务器来说未知（例如，新的或重新使用的计算机），则不会显示****“此计算机”选项。

11. 在****“选择要还原的备份”页上，查看可用备份的列表，然后选择你要还原到计算机的备份。

    > [!NOTE]
    >  建议你选择一个成功的（带有绿色复选标记）备份。 这有助于确保成功还原所有系统和数据文件。

12. （*可选*）选择一个备份，然后单击****“详细信息”打开****“备份详细信息”页面，查看有关此备份的详细信息。 使用****“备份详细信息”页上的信息可以比较多个备份，并帮助你确定最佳备份选择。 单击****“备份详细信息”页上的****“关闭”以返回****“选择要还原的备份”页面。

13. 在****“选择要还原的备份”页上，选择一个备份，然后单击****“下一步”按钮。

14. 在****“选择还原选项”页上，执行下列操作之一，然后单击****“下一步”。

    > [!NOTE]
    >  如果不支持自动分区，则不会显示此页面。

    1.  “通过向导完全还原计算机(推荐)”****。 此选项有助于确保将计算机还原为它在你选择的备份时间和日期之前的状态。 如果选择此选项，将跳到步骤 15。

    2.  **让我选择要还原的卷(高级)**。 此选项允许你选择要还原的卷及其还原位置。 你还可以在硬盘上创建分区。

15. 在****“选择要还原的卷”页上，你可以选择要还原的卷。

    > [!NOTE]
    >  如果备份源计算机上存在多个硬盘，或是如果还原目标驱动器的存储空间少于备份源驱动器，则会显示此页。

    1. 该向导会尝试匹配源卷与目标卷。 你应该验证默认映射是否正确。

       1.  若要取消选择某个卷，单击此卷的列表菜单箭头，然后单击****“无”。

       2.  选择卷后，单击****“下一步”。

    2. 如果源卷的大小等于或小于目标卷的大小，则会在这两者之间出现一个绿色箭头。 如果这两个卷的大小不匹配（源卷比目标卷大），则会在源卷和目标卷之间出现一个红色的 X。

       > [!NOTE]
       >  如果出现以下情况，也会出现红色的 X：
       >
       > - 源卷的磁盘扇区大小和目标卷的磁盘扇区大小不匹配。 如果你用不同扇区大小的磁盘替换物理磁盘，或配置“存储空间”（可能与物理磁盘的扇区大小不同），就会出现这种情况。
       >   -   你达到簇数量限制。 要将源卷恢复至目标卷，你必须对目标卷进行格式化，使其簇大小与源卷相同。 如果目标卷太大，而簇太小，你就会达到簇数量限制。

       1. 单击****“运行磁盘管理器(高级)”，然后创建一个与系统保留卷大小相同的新卷。

          > [!NOTE]
          >  如果客户端计算机统一可扩展固件接口 (基于 UEFI) ，则必须使用 **diskpart** 工具初始化系统磁盘。 为此，请打开命令窗口（在 WinPE 环境中按 Ctrl+Alt+Shift 5 秒钟），运行 **diskpart.exe**，然后运行以下 diskpart 命令：
          >
          > 1. **DISKPART> 列出磁盘**
          >    2. **DISKPART> 选择磁盘号** *<磁盘 \> *
          >    3. **DISKPART>clean**
          >    4. **DISKPART>convert gpt**
          >    5. **DISKPART> create partition efi size =** *100* (其中 *100* 是示例分区大小，单位为 MB，应与原始分区相同) 
          >    6. **DISKPART> create partition msr size =** *128* (其中 *128* 是示例分区大小，单位为 MB，应与原始分区相同) 
          >    7. **DISKPART>exit**

       2. *（可选）* 选择选项“不分配驱动器号或驱动器路径”****。

       3. 将卷格式化为 **NTFS**。

       4. 格式化完成后，右键单击新系统卷，然后单击****“将磁盘分区标为活动的”。

       5. 如果还需要创建一些卷，以与备份中的其他卷一致，请重复步骤 *b* 到 *d* 来创建并激活卷，然后关闭****“磁盘管理”。

       6. 在****“选择要还原的卷”页上，将备份源的系统保留卷映射到在步骤 *e* 中创建的大小相同的卷。

       7. 将所有其他源卷映射到相应的目标卷。

       8. 单击****“下一步”以继续还原。

16. 在****“确认要还原的卷”页上，查看映射，然后单击****“下一步”。 如果你需要进行任何更改，可以单击****“上一步”，然后重复步骤 14。

17. ** \> 从 "备份 \> <日期和时间还原 <ComputerName** " 页将报告还原过程的进度。

18. 在****“已成功完成还原”页上，删除还原介质，然后单击****“完成”。 计算机将重新启动。

    > [!IMPORTANT]
    >  如果还原前计算机上启用了 BitLocker 驱动器加密，则必须在计算机重新启动后手动启用 BitLocker。

##  <a name="where-can-i-find-the-drivers-for-my-hardware"></a><a name="BKMK_FindDrivers"></a> 在哪里可以找到适用于我的硬件的驱动程序？
 还原介质可能不包括重新启动已还原计算机时所需的所有存储和网络适配器驱动程序，具体取决于新计算机或已还原计算机硬件。 您必须确定缺少的驱动程序，在现有介质或制造商的网站上找到这些驱动程序，将它们复制到闪存驱动器，然后在运行完整系统还原向导时将它们从闪存驱动器复制到新的或还原的计算机。

 备份计算机后，计算机的驱动程序将保存在此备份中。 如果恢复介质不包括你所需要的所有驱动程序，你可以打开该计算机的一个备份，然后将驱动程序复制到 U 盘。

#### <a name="to-copy-drivers-from-a-backup-to-a-usb-flash-drive"></a>将驱动程序从备份复制到 U 盘

1. 在另一台计算机上，打开“仪表板”。

2. 单击****“设备”，然后单击你需要其驱动程序的计算机。

3. 单击****“为计算机还原文件或文件夹”。 此时将打开“还原文件或文件夹向导”。

4. 单击最近的成功备份，然后单击****“下一步”。

5. 单击要打开的卷，然后单击****“下一步”。 此时将打开一个窗口，其中列出了备份中的文件和文件夹。

6. 将 U 盘插入计算机上的 USB 连接器，然后将“适用于完整系统还原的驱动程序”文件夹复制到 U 盘。

   > [!NOTE]
   >  你可能需要单击****“向上一级”，直到到达系统卷的根目录。

7. 取出闪存驱动器，然后将其插入你要还原的计算机。

   你可以在还原计算机时使用 U 盘来安装计算机所需的驱动程序。 在使用完整系统还原向导时，还原文件或文件夹向导会查找此 U 盘上的附加驱动程序。 你最有可能需要的驱动程序是网络适配器驱动程序和存储设备驱动程序。

## <a name="additional-references"></a>其他参考

-   [管理备份和还原](Manage-Backup-and-Restore-in-Windows-Server-Essentials.md)

-   [管理 Windows Server Essentials](Manage-Windows-Server-Essentials.md)
