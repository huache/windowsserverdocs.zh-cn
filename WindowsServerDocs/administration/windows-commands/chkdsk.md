---
title: chkdsk
description: Chkdsk 命令的参考文章，用于检查卷的文件系统和文件系统元数据，以查找逻辑和物理错误。
ms.topic: reference
ms.assetid: 62912a3c-d2cc-4ef6-9679-43709a286035
author: jasongerend
ms.author: jgerend
manager: lizapo
ms.date: 10/09/2019
ms.openlocfilehash: 610b7fe54387e54a49b2bd4a3ee0086c5d7adaa2
ms.sourcegitcommit: 96d46c702e7a9c3a321bbbb5284f73911c7baa3c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/27/2020
ms.locfileid: "89026185"
---
# <a name="chkdsk"></a>chkdsk

检查卷的文件系统和文件系统元数据，以查找逻辑错误和物理错误。 如果在没有参数的情况下使用， **chkdsk** 只显示卷的状态，并且不会修复任何错误。 如果与 **/f**、 **/r**、 **/x**或 **/b** 参数一起使用，则会修复卷上的错误。

> [!IMPORTANT]
> 本地 **Administrators** 组中的成员身份或等效身份是运行 **chkdsk**所需的最低要求。 若要以管理员身份打开 "命令提示符" 窗口，请在 "**开始**" 菜单中右键单击 "**命令提示符**"，然后单击 "以**管理员身份运行**"。

> [!IMPORTANT]
> 不建议中断 **chkdsk** 。 但是，取消或中断 **chkdsk** 不应使卷的损坏时间比运行 **chkdsk** 之前更多。 再次运行 **chkdsk** 会检查并修复卷上的任何剩余损坏。

> [!NOTE]
> Chkdsk 只能用于本地磁盘。 此命令不能与已通过网络重定向的本地驱动器号一起使用。

## <a name="syntax"></a>语法

```
chkdsk [<volume>[[<path>]<filename>]] [/f] [/v] [/r] [/x] [/i] [/c] [/l[:<size>]] [/b]
```

### <a name="parameters"></a>参数

| 参数 | 说明 |
| --------- | ----------- |
| `<volume>` | 指定驱动器号 (后跟冒号) 、装入点或卷名。 |
| [ `[<path>]<filename>` | 仅将用于文件分配表 (FAT) 和 FAT32。 指定您希望 **chkdsk** 检查碎片的文件或文件集的位置和名称。 您可以使用 **？** 和 **&#42;** 通配符来指定多个文件。 |
| /f | 修复磁盘上的错误。 必须锁定磁盘。 如果 **chkdsk** 无法锁定驱动器，则会出现一条消息，询问您是否要在下次重新启动计算机时检查驱动器。 |
| /v | 检查磁盘时，显示每个目录中每个文件的名称。 |
| /r | 查找坏扇区并恢复可读的信息。 必须锁定磁盘。 **/r** 包括 **/f**的功能，并对物理磁盘错误进行额外的分析。 |
| /x | 必要时强制首先卸除卷。 驱动器的所有打开的句柄都将失效。 **/x** 还包括 **/f**的功能。  |
| /i | 仅适用于 NTFS。 对索引条目执行更少的经历检查，这会减少运行 **chkdsk**所需的时间。 |
| /c | 仅适用于 NTFS。 不检查文件夹结构内的循环，这会减少运行 **chkdsk**所需的时间。  |
| /l [： `<size>` ] | 仅适用于 NTFS。 将日志文件大小更改为你键入的大小。 如果省略 size 参数，则 **/l** 显示当前大小。 |
| /b | 仅适用于 NTFS。 清除卷上的坏簇列表，并重新扫描所有已分配和可用的群集以查找错误。 **/b** 包括 **/r**的功能。 在将卷镜像到新硬盘驱动器之后，使用此参数。 |
| /scan | 仅适用于 NTFS。 在卷上运行联机扫描。 |
| /forceofflinefix | 使用 with NTFS 仅 (必须与 **/scan**) 一起使用。 绕过所有联机修复;所有发现的缺陷都排队等候脱机修复 (例如 `chkdsk /spotfix`) 。 |
| /perf | 使用 with NTFS 仅 (必须与 **/scan**) 一起使用。 使用更多系统资源尽可能快地完成扫描。 这可能会对系统上运行的其他任务造成负面的性能影响。 |
| /spotfix | 仅适用于 NTFS。 在卷上运行点修复。 |
| /sdcleanup | 仅适用于 NTFS。 垃圾收集不需要的安全描述符数据 (隐含 **/f**) 。 |
| /offlinescanandfix | 在卷上运行脱机扫描并修复。 |
| /freeorphanedchains | 仅用于 FAT/FAT32/exFAT。 释放任何孤立的群集链，而不是恢复其内容。 |
| /markclean | 仅用于 FAT/FAT32/exFAT。 如果未检测到损坏，则将卷标记为干净，即使未指定 **/f** 也是如此。 |
| /? | 在命令提示符下显示帮助。 |

## <a name="remarks"></a>注解

- **/I**或 **/c**开关通过跳过某些卷检查来减少运行**chkdsk**所需的时间。

- 如果希望 **chkdsk** 更正磁盘错误，则无法在驱动器上打开文件。 如果文件已打开，则显示以下错误消息：

  ```
  Chkdsk cannot run because the volume is in use by another process. Would you like to schedule this volume to be checked the next time the system restarts? (Y/N)
  ```

- 如果选择在下次重新启动计算机时检查驱动器，则 **chkdsk** 会在重新启动计算机时自动检查驱动器并更正错误。 如果驱动器分区是启动分区，则在它检查驱动器后， **chkdsk** 会自动重新启动计算机。

- 你还可以使用 `chkntfs /c` 命令来计划下次重新启动计算机时要检查的卷。 使用 `fsutil dirty set` 命令设置卷的脏位 (指示损坏) ，以便 Windows 在计算机重新启动时运行 **chkdsk** 。

- 你应偶尔在 FAT 和 NTFS 文件系统上使用 **chkdsk** 来检查磁盘错误。 **Chkdsk** 检查磁盘空间和磁盘使用情况，并提供特定于每个文件系统的状态报告。 状态报告显示在文件系统中找到的错误。 如果在活动分区上不使用 **/f**参数运行**chkdsk** ，它可能会报告虚假错误，因为它无法锁定驱动器。

- 只有在指定 **/f**参数时， **Chkdsk**才能更正逻辑磁盘错误。 **Chkdsk** 必须能够锁定驱动器以纠正错误。

  由于 FAT 文件系统上的修复通常会更改磁盘的文件分配表，有时会导致数据丢失，因此， **chkdsk** 可能会显示类似于以下内容的确认消息：

  ```
  10 lost allocation units found in 3 chains.
  Convert lost chains to files?
  ```

    - 如果按 **Y**，Windows 会将根目录中丢失的每个链作为文件保存在格式文件中 `<nnnn>` 。 **Chkdsk**完成后，可以检查这些文件，查看它们是否包含所需的任何数据。

    - 如果按 **N**，Windows 将修复磁盘，但不会保存丢失的分配单元的内容。

- 如果不使用 **/f** 参数， **chkdsk** 将显示一条消息，指出需要修复文件，但不会修复任何错误。

- 如果 `chkdsk /f*` 在非常大的磁盘或包含大量文件的磁盘上使用 (例如，百万个文件) ，则 `chkdsk /f` 可能需要很长时间才能完成。

- 使用 **/r** 参数查找文件系统中的物理磁盘错误，并尝试从任何受影响的磁盘扇区恢复数据。

- 如果指定 **/f** 参数，则当磁盘上存在打开的文件时， **chkdsk** 会显示错误消息。 如果未指定 **/f** 参数并且打开的文件存在，则 **chkdsk** 可能会报告磁盘上丢失的分配单元。 如果打开的文件尚未记录在文件分配表中，则可能会发生这种情况。 如果 **chkdsk** 报告大量分配单元丢失，请考虑修复磁盘。

- 由于在启用 **共享文件夹的卷影副本** 时无法锁定共享文件夹的卷影副本源卷，因此针对源卷运行 **chkdsk** 可能会报告错误或导致 **chkdsk** 意外退出。 但是，可以通过在只读模式下运行 **chkdsk** 来检查卷影副本是否存在错误， (没有参数) 检查共享文件夹的卷影副本存储卷。

- 可从恢复控制台获取带有不同参数的 **chkdsk** 命令。

- 在不经常重新启动的服务器上，你可能想要使用 **chkntfs** 或 `fsutil dirty query` 命令来确定在运行 chkdsk 之前是否已设置卷的已更新位。

### <a name="understanding-exit-codes"></a>了解退出代码

下表列出了 **chkdsk** 在完成后报告的退出代码。

  | 退出代码 | 说明 |
  | --------- | ----------- |
  | 0 | 未发现任何错误。 |
  | 1 | 发现并修复了错误。 |
  | 2 | 执行了磁盘清理 (如垃圾回收) 或未执行清理，因为未指定 **/f** 。 |
  | 3 | 无法检查磁盘，无法修复错误，或由于未指定 **/f** 而导致错误未修复。 |

## <a name="examples"></a>示例

若要检查驱动器 D 中的磁盘并让 Windows 修复错误，请键入：

```
chkdsk d: /f
```

如果遇到错误， **chkdsk** 将暂停并显示消息。 **Chkdsk** 通过显示列出磁盘状态的报告完成。 在 **chkdsk** 完成之前，无法打开指定驱动器上的任何文件。

若要在当前目录中的非连续块中检查 FAT 磁盘上的所有文件，请键入：

```
chkdsk *.*
```

**Chkdsk** 显示状态报告，然后列出与具有非连续块的文件规范匹配的文件。

## <a name="additional-references"></a>其他参考

- [命令行语法项](command-line-syntax-key.md)
